<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="./favicon.ico">
    <title>M06 - Prova UF2</title>
    <style>
        body {
            margin: 0 auto;
            width: 80%;
        }
        li {
            display: inline-block;
            margin-right: 24px;
        }
    </style>
</head>

<body>

    <h1>Meses</h1>

    <div id="mesa1" class="mesa">
        <h2>Mesa <span class="id">1</span> (<span class="numPers">3</span> persones) 
            <button class="add">+</button>
            <button class="del">x</button></h2>
        <ul>
        </ul>
    </div>

    <div id="mesa2" class="mesa">
        <h2>Mesa <span class="id">2</span> (<span class="numPers">4</span> persones) 
            <button class="add">+</button>
            <button class="del">x</button></h2>
        <ul>
        </ul>
    </div>

    <div id="verificador">
        <h1>M'ha tocat?</h1>
        <p>Posa el teu nom i verifica-ho:</p>
        <select name="nom"></select> <button>?</button>
        <p  class="resposta si">Sí, t'ha tocat a la mesa <span class="id">1</span>.</p>
        <p  class="resposta no">No, no t'ha tocat cap mesa.</p>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
		crossorigin="anonymous">
    </script>

    <script>
        // Tenim 24 persones a sortejar
        var persones = [
            /*  0 */ "Armand", "Pep", "Laura", "David", 
            /*  4 */ "Lorena", "Angel", "Dani", "Eulalia", 
            /*  8 */ "Miquel", "Aleix", "Joan", "Jordi",
            /* 12 */ "Laia", "Alba", "Toni", "Carme", 
            /* 16 */ "Noelia", "Magda", "Merce", "Joel", 
            /* 20 */ "Juli", "Jorge", "Ferran", "Pol"
        ];
        
        // Carreguem totes les persones al desplegable
        var $select = $("select[name='nom']");
        for (let p in persones) {
            let $opt = $("<option>").val(p).html(persones[p] + " (" + p + ")");
            $select.append($opt);
        }
        
        // Teniu aquesta funció que us pot ajudar
        function randomPers() {
            return Math.floor(Math.random() * persones.length);
        };      

        /**
         *  Resolució a partir d'AQUÍ !!!
         */
        
        // PART 1
        class Mesa{
            #div;
            #sorteig;
            id;
            numPers;
            
            constructor(div){
                let save = this;
                this.#sorteig = [];
                this.#div = div;
                this.id = $(div + " .id").text();
                this.numPers = $(div + " .numPers").text();
                $(div + " .add").click(function(){
                    save.genera();
                });
                $(div + " .del").click(function(){
                    save.reinicia();
                });
            }

            genera(){
                if(this.#sorteig.length < this.numPers){
                    let value = Math.round(Math.random()*persones.length);
                    while(this.verifica(value)){
                        value = Math.round(Math.random()*persones.length);
                    }
                    this.#sorteig.push(value);
                    $(this.#div + ' ul').append("<li>"+value+"</li>");
                    this.refresca();
                } else{
                    console.log("lleno")
                }
            }
            
            reinicia(){
                this.refresca();
                $(this.#div + ' ul').empty()
                this.#sorteig = [];
            }

            refresca(){
                if($(this.#div + " .add").is(":disabled") == false && this.#sorteig.length == this.numPers){
                    $(this.#div + " .add").attr("disabled", true);
                } else {
                    $(this.#div + " .add").attr("disabled", false);
                }
            }

            verifica(id){
                let lis = [];
                $('ul li').each(function(i){
                    lis.push(parseInt($(this).text()))
                });
                let result = false;
                if(this.#sorteig.includes(id) || lis.includes(id)){
                    result = true;
                }
                return result;
            }

            //Para la parte 2 he pensado en hacer un get para devolver la lista sorteig
            getSorteig(){
                return this.#sorteig;
            }
        }
        
        // PART 2
        function enMesa(id,mesas){
            let mesa1 = mesas[0].getSorteig();
            let mesa2 = mesas[1].getSorteig();

            if(mesa1.includes(parseInt(id))){
                $("#verificador .si .id").text("1");
                $("#verificador .si").show();
                $("#verificador .no").hide();
            }else if(mesa2.includes(parseInt(id))){
                $("#verificador .si .id").text("2");
                $("#verificador .si").show();
                $("#verificador .no").hide();
            } else {
                $("#verificador .si").hide();
                $("#verificador .no").show();

            }
        }


        var mesas = [new Mesa("#mesa1"), new Mesa("#mesa2")]

        $("#verificador button").click(function(){
            enMesa($(this).parent().children("select").val(),mesas);
        })

    </script>

</body>

</html>